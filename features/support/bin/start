#!/usr/bin/env ruby
# frozen_string_literal: true

require 'socket'

Socket.tcp_server_loop(12_321) do |conn, _addr|
  Thread.new do
    loop do
      line = conn.readline.strip
      puts "Received line: '#{line}'"

      conn.puts(line)
      puts "Sent line: '#{line}'"
    end
  rescue EOFError
    conn.close
  end
end
